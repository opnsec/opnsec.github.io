{"id":220,"date":"2017-10-19T12:27:10","date_gmt":"2017-10-19T12:27:10","guid":{"rendered":"https:\/\/opnsec.com\/?p=220"},"modified":"2021-07-30T20:07:09","modified_gmt":"2021-07-30T20:07:09","slug":"flashme-wordpress-vulnerability-disclosure-cve-2016-9263","status":"publish","type":"post","link":"https:\/\/opnsec.com\/2017\/10\/flashme-wordpress-vulnerability-disclosure-cve-2016-9263\/","title":{"rendered":"FlashME! &#8211; WordPress vulnerability disclosure [CVE-2016-9263]"},"content":{"rendered":"<p><img loading=\"lazy\" class=\"alignnone size-thumbnail wp-image-235\" style=\"display: none;\" src=\"http:\/\/opnsec.com\/wp-content\/uploads\/2017\/10\/FlashMEcropped-150x150.png\" alt=\"\" width=\"150\" height=\"150\" \/>Last week, I disclosed the existence of an unpatched Flash vulnerability on WordPress (<a href=\"https:\/\/opnsec.com\/2017\/10\/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress\/\">https:\/\/opnsec.com\/2017\/10\/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress\/<\/a>). Today, I disclose technical details about this vulnerability. However, contrary to what I announced before, I won&#8217;t provide a POC nor enough technical details to allow attackers to exploit it. Responsible disclosure of unpatched vulnerabilities is never easy, and I&#8217;m trying to do this right both ethically and legally.<\/p>\n<p>If you want to know more about the type of vulnerability, the impact and how to patch it please refer to <a href=\"https:\/\/opnsec.com\/2017\/10\/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress\/\">https:\/\/opnsec.com\/2017\/10\/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress\/<\/a>.<\/p>\n<h3>Technical details<\/h3>\n<p>WordPress uses an independent open-source tool to play videos in a webpage, MediaElement.js. ME.js provides a Flash fallback for browsers that don&#8217;t support the &lt;video&gt; tag or certain video codecs, using the flash file FlashMediaElement.swf. Vulnerabilities on this file have been reported in the past, like the awesome Flash based XSS found by <a href=\"https:\/\/twitter.com\/cure53berlin\" target=\"_blank\" rel=\"noopener noreferrer\">cure53<\/a> <a href=\"https:\/\/gist.github.com\/cure53\/df34ea68c26441f3ae98f821ba1feb9c\">https:\/\/gist.github.com\/cure53\/df34ea68c26441f3ae98f821ba1feb9c<\/a>.<\/p>\n<p>While investigating the source of this file in summer 2016, one particular instruction catched my attention<\/p>\n<pre><code >Security.allowDomain(\"www.[XYZ].com\");<\/code><\/pre>\n<blockquote><p>Note: I changed the real name of the domain to [XYZ].com<\/p><\/blockquote>\n<p><a href=\"http:\/\/help.adobe.com\/en_US\/FlashPlatform\/reference\/actionscript\/3\/flash\/system\/Security.html#allowDomain()\" target=\"_blank\" rel=\"noopener noreferrer\">Security.allowDomain()<\/a> can be described as a vulnerable function: using it will downplay the <a href=\"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/Security\/Same-origin_policy\" target=\"_blank\" rel=\"noopener noreferrer\">Same-Origin Policy<\/a> which is the basis of website client-side security. You can read more about Flash security sandbox model <a href=\"http:\/\/www.senocular.com\/flash\/tutorials\/contentdomains\/\" target=\"_blank\" rel=\"noopener noreferrer\">here<\/a>.<\/p>\n<p>This code will allow a Flash file hosted on [XYZ].com to execute code on the FlashMediaElement.swf file, which is hosted on the WordPress site domain. [XYZ].com is a very well established company, so you could safely think that they would not use this privilege to execute malicious code on your website, the same way you would allow Google Analytics or Youtube to run scripts on your website. However, it is not that simple. With Security.allowDomain(&#8220;www.[XYZ].com&#8221;), you allow not only one specific file hosted on [XYZ].com to access your Flash security sandbox but any Flash file hosted on [XYZ].com.<\/p>\n<blockquote><p>Quick reminder about <a href=\"https:\/\/www.owasp.org\/index.php\/Cross-site_Scripting_(XSS)\" target=\"_blank\" rel=\"noopener noreferrer\">Cross-Site Scripting<\/a>:\u00a0XSS is the ability to execute arbitrary code (script, in this case Flash ActionScript3) in an external website. Not only a XSS allows you to access private info (like cookies) and private functions (like xhr requests) on the external website, but the arbitrary code will also be considered by the browser (or the Flash player) to be originating from the vulnerable website. This subtlety is what we will exploit here.<\/p><\/blockquote>\n<p>The thing is that [XYZ].com is vulnerable itself to XSS, or in this case Cross-Site Flashing. Which means that an attacker can execute arbitrary Flash code that will be considered by the Flash player as being originating from [XYZ].com. This forms a chain of vulnerabilities that will end up with any WordPress website being vulnerable to Cross-Site Flashing. Let&#8217;s make a drawing:<\/p>\n<p><a href=\"http:\/\/opnsec.com\/wp-content\/uploads\/2017\/10\/FlashME.svg\"><img loading=\"lazy\" class=\"wp-image-228 aligncenter\" src=\"http:\/\/opnsec.com\/wp-content\/uploads\/2017\/10\/FlashME.svg\" alt=\"\" width=\"969\" height=\"485\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h3>Facebook was vulnerable, too<\/h3>\n<p>A few months after reporting this issue, I was investigating various Flash files on facebook.com. One file contained the following instruction:<\/p>\n<pre><code >Security.allowDomain(\"www.[XYZ].com\");<\/code><\/pre>\n<p>Facebook was using a file similar to flashmediaelement.swf to embed external videos on Facebook wall. The same vulnerability was present in this file and I was able to create various POC exploits using this vulnerability that would lead to Facebook OAuth bypass and even Facebook account takeover without user interaction.<\/p>\n<p>I reported the issue to <a href=\"https:\/\/www.facebook.com\/whitehat\" target=\"_blank\" rel=\"noopener noreferrer\">Facebook WhiteHat <\/a>program and Facebook Security Team quickly fixed the issue and generously rewarded me.<\/p>\n<h3>Conclusion<\/h3>\n<p>This vulnerability is complex because it relies on multiple factors, technologies and companies. However, once an attacker is able to create an exploit, exploiting this vulnerability is easy because all of the requirements are usually present by default on a system. This vulnerability not only affects WordPress websites, but every websites hosted on the same subdomain as a WordPress website.<\/p>\n<p>I hope WordPress will patch this issue soon and that my report will help raise awareness about Chained XSS vulnerabilities. Thanks for reading!<\/p>\n\n<div class=\"twitter-share\"><a href=\"https:\/\/twitter.com\/intent\/tweet?via=opnsec\" class=\"twitter-share-button\">Tweet<\/a><\/div>\n","protected":false},"excerpt":{"rendered":"<p>Last week, I disclosed the existence of an unpatched Flash vulnerability on WordPress (https:\/\/opnsec.com\/2017\/10\/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress\/). Today, I disclose technical details about this vulnerability. However, contrary to what I announced before, I won&#8217;t provide a POC nor enough technical details to allow attackers to exploit it. Responsible disclosure of unpatched vulnerabilities is never easy, and I&#8217;m trying&hellip; <a class=\"read-more\" href=\"https:\/\/opnsec.com\/2017\/10\/flashme-wordpress-vulnerability-disclosure-cve-2016-9263\/\">Read More<\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":""},"categories":[1],"tags":[],"jetpack_featured_media_url":"","_links":{"self":[{"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/posts\/220"}],"collection":[{"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/comments?post=220"}],"version-history":[{"count":13,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/posts\/220\/revisions"}],"predecessor-version":[{"id":377,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/posts\/220\/revisions\/377"}],"wp:attachment":[{"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/media?parent=220"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/categories?post=220"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/opnsec.com\/wp-json\/wp\/v2\/tags?post=220"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}